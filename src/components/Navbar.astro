---
import GlitchText from "./GlitchText.astro";
import LucideIcon from "./icons/LucideIcon.astro";
import { navigationData } from "../data/navigation";

interface Props {
        currentPath?: string;
}

const { currentPath = "/" } = Astro.props as Props;

const normalizePath = (path: string) => {
        if (!path) return "/";
        return path.length > 1 && path.endsWith("/") ? path.slice(0, -1) : path;
};

const normalizedCurrentPath = normalizePath(currentPath);

const getActivePath = (path: string) => {
        if (path.startsWith("/writing/") || path === "/writing") {
                return "/writing";
        }
        if (path.startsWith("/demo")) {
                return "/demo";
        }
        return path;
};

const activePath = getActivePath(normalizedCurrentPath);

const isActive = (href: string) => getActivePath(normalizePath(href)) === activePath;

const { brand, items, demoItems } = navigationData;
---
<a
        href="#main"
        class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-black text-white px-4 py-2 border-2 border-black shadow-[2px_2px_0px_0px_rgba(255,255,255,1)] z-50"
>
        Skip to main content
</a>
<nav class="navbar nav-surface fixed top-0 left-0 right-0 z-40">
        <div class="nav-shell mx-auto flex h-16 w-full max-w-7xl items-center justify-between gap-4 px-4">
                <div class="navbar-start">
                        <a href="/" class="nav-brand relative inline-flex items-center gap-2" aria-label="Nick Roth home">
                                <span class="text-xl font-display font-black leading-none text-black">
                                        <GlitchText text={brand.first} />
                                </span>
                                <span class="inline-flex -rotate-1 items-center border-2 border-black bg-gradient-to-r from-fuchsia-500 to-purple-600 px-2 py-1 font-display text-xl font-black text-white shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]">
                                        <GlitchText text={brand.last} />
                                </span>
                                <span class="absolute -top-1 -right-1 h-1.5 w-1.5 rounded-full border border-black bg-lime-400"></span>
                                <span class="absolute -bottom-1 -left-1 h-2 w-1 rotate-45 border border-black bg-cyan-400"></span>
                        </a>
                </div>

                <div class="navbar-center hidden md:flex">
                        <ul class="menu menu-horizontal items-center gap-2">
                                {items.map((item) => (
                                        <li>
                                                <a
                                                        href={item.href}
                                                        class={`btn btn-sm btn-nav ${isActive(item.href) ? "btn-nav-active" : "btn-nav-default"}`}
                                                        aria-current={isActive(item.href) ? "page" : undefined}
                                                >
                                                        <LucideIcon name={item.icon} class="h-4 w-4" />
                                                        <span>{item.label}</span>
                                                </a>
                                        </li>
                                ))}
                                <li>
                                        <div class="dropdown dropdown-hover dropdown-end">
                                                <label
                                                        tabindex="0"
                                                        class={`btn btn-sm btn-nav ${
                                                                activePath === "/demo" ? "btn-nav-active" : "btn-nav-default"
                                                        }`}
                                                        aria-haspopup="true"
                                                        aria-expanded={activePath === "/demo"}
                                                >
                                                        <LucideIcon name="zap" class="h-4 w-4" />
                                                        <span>Demo</span>
                                                        <LucideIcon name="chevron-down" class="h-3 w-3 nav-chevron" ariaHidden={true} />
                                                </label>
                                                <ul
                                                        tabindex="0"
                                                        class="menu menu-sm dropdown-content nav-dropdown-panel mt-3 w-72 gap-2 p-3"
                                                >
                                                        {demoItems.map((item) => (
                                                                <li>
                                                                        <a href={item.href} class="nav-dropdown-link">
                                                                                <span class="font-bold text-black">{item.label}</span>
                                                                                <span class="text-sm text-gray-600">{item.description}</span>
                                                                        </a>
                                                                </li>
                                                        ))}
                                                </ul>
                                        </div>
                                </li>
                        </ul>
                </div>

                <div class="navbar-end md:hidden">
                        <details class="dropdown dropdown-end nav-mobile-toggle">
                                <summary class="btn btn-square btn-nav btn-nav-default">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-open flex">
                                                <LucideIcon name="menu" class="h-6 w-6" ariaHidden={true} />
                                        </span>
                                        <span class="icon-close hidden">
                                                <LucideIcon name="x" class="h-6 w-6" ariaHidden={true} />
                                        </span>
                                </summary>
                                <div class="dropdown-content nav-mobile-panel">
                                        <ul class="menu menu-vertical gap-3">
                                                {items.map((item) => (
                                                        <li>
                                                                <a
                                                                        href={item.href}
                                                                        class={`btn btn-nav btn-nav-block ${
                                                                                isActive(item.href)
                                                                                        ? "btn-nav-active"
                                                                                        : "btn-nav-default"
                                                                        }`}
                                                                        aria-current={isActive(item.href) ? "page" : undefined}
                                                                >
                                                                        <LucideIcon name={item.icon} class="h-4 w-4" />
                                                                        <span>{item.label}</span>
                                                                </a>
                                                        </li>
                                                ))}
                                                <li class="menu-title nav-mobile-status">Demo</li>
                                                {demoItems.map((item) => (
                                                        <li>
                                                                <a href={item.href} class="btn btn-nav btn-nav-block btn-nav-default">
                                                                        <LucideIcon name="zap" class="h-4 w-4" />
                                                                        <span>Demo â€¢ {item.label}</span>
                                                                </a>
                                                        </li>
                                                ))}
                                        </ul>
                                </div>
                        </details>
                </div>
        </div>
</nav>
