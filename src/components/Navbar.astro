---
import avatarPlaceholder from '../assets/images/avatar-placeholder.svg';

type NavItem = {
  href: string;
  label: string;
  icon: string;
};

interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props as Props;

const normalizePath = (path: string) => {
  if (!path) return '/';
  return path.length > 1 && path.endsWith('/') ? path.slice(0, -1) : path;
};

const normalizedCurrentPath = normalizePath(currentPath);

const isActive = (href: string) => {
  const normalizedHref = normalizePath(href);
  if (normalizedHref === '/') {
    return normalizedCurrentPath === '/';
  }
  return (
    normalizedCurrentPath === normalizedHref ||
    normalizedCurrentPath.startsWith(`${normalizedHref}/`)
  );
};

const navItems: NavItem[] = [
  { href: '/work', label: 'Work', icon: '✹' },
  { href: '/approach', label: 'Approach', icon: '△' },
  { href: '/background', label: 'Background', icon: '✦' },
  { href: '/contact', label: 'Contact', icon: '✱' },
];
---

<header class="sticky top-0 z-40 backdrop-blur-xl transition-colors duration-300">
  <div class="relative border-b border-base-300/50 bg-base-100/80 shadow-[0_1px_0_rgba(15,23,42,0.08)] dark:shadow-[0_1px_0_rgba(148,163,184,0.18)]">
    <div class="pointer-events-none absolute inset-0 opacity-70 mix-blend-soft-light" aria-hidden="true">
      <div class="absolute inset-x-8 bottom-0 h-px bg-gradient-to-r from-transparent via-primary/40 to-transparent"></div>
      <div class="absolute -top-24 right-12 h-48 w-48 rounded-full bg-gradient-to-br from-primary/25 via-transparent to-accent/25 blur-3xl"></div>
    </div>
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="navbar px-0">
        <div class="navbar-start">
          <div class="dropdown">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle lg:hidden">
              <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15" />
              </svg>
            </div>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] w-60 space-y-1 rounded-box border border-base-300/60 bg-base-100/90 p-3 shadow-brutal">
              {navItems.map((item: NavItem) => (
                <li>
                  <a
                    href={item.href}
                    class="nav-link nav-link--mobile"
                    data-active={isActive(item.href)}
                    aria-current={isActive(item.href) ? 'page' : undefined}
                  >
                    <span aria-hidden="true" class="text-base">{item.icon}</span>
                    <span class="nav-link__label">{item.label}</span>
                  </a>
                </li>
              ))}
            </ul>
          </div>
          <a
            href="/"
            class={`brand-link btn btn-ghost px-2 sm:px-3 text-lg font-semibold tracking-tight transition-colors duration-300 ${isActive('/') ? 'text-primary' : 'text-base-content'}`}
            aria-current={isActive('/') ? 'page' : undefined}
            transition:name="brand-logo"
          >
            <span class="avatar placeholder mr-3">
              <div class="w-9 rounded-xl bg-secondary text-secondary-content flex items-center justify-center font-semibold">
                <img src={avatarPlaceholder.src} alt="Nick Roth" loading="lazy" class="w-full h-full object-cover mix-blend-multiply" />
              </div>
            </span>
            Nick Roth
          </a>
        </div>
        <div class="navbar-center hidden lg:flex">
          <nav aria-label="Primary" class="flex items-center gap-1">
            {navItems.map((item: NavItem) => (
              <a
                href={item.href}
                class="nav-link"
                data-active={isActive(item.href)}
                aria-current={isActive(item.href) ? 'page' : undefined}
              >
                <span aria-hidden="true" class="nav-link__icon">{item.icon}</span>
                <span class="nav-link__label">{item.label}</span>
              </a>
            ))}
          </nav>
        </div>
        <div class="navbar-end gap-3">
          <span class="hidden sm:inline-flex text-xs tracking-wide uppercase text-base-content/60">Theme</span>
          <label class="swap swap-rotate">
            <input type="checkbox" class="theme-controller" value="nick-dark" />
            <svg class="swap-off fill-current w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z" /></svg>
            <svg class="swap-on fill-current w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z" /></svg>
          </label>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
  header {
    view-transition-name: site-nav;
    position: relative;
  }

  .brand-link {
    position: relative;
    isolation: isolate;
    transition: transform 220ms ease;
  }

  .brand-link::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 18px;
    opacity: 0;
    background: linear-gradient(120deg, rgba(255, 77, 154, 0.38), rgba(72, 242, 255, 0.28));
    transition: opacity 220ms ease;
    z-index: -1;
  }

  .brand-link:hover::after,
  .brand-link:focus-visible::after {
    opacity: 1;
  }

  .brand-link:hover,
  .brand-link:focus-visible {
    transform: translateY(-1px);
  }

  .nav-link {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    border-radius: 9999px;
    padding: 0.65rem 1.25rem;
    text-transform: uppercase;
    letter-spacing: 0.28em;
    font-size: 0.68rem;
    font-weight: 600;
    color: hsl(var(--nc));
    transition: transform 220ms cubic-bezier(0.19, 1, 0.22, 1), box-shadow 240ms ease, color 200ms ease;
    isolation: isolate;
  }

  .nav-link::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(120deg, rgba(255, 77, 154, 0.16), rgba(72, 242, 255, 0.16));
    opacity: 0;
    transform: scaleX(0.9) scaleY(0.84);
    transition: opacity 220ms ease, transform 260ms ease;
    z-index: -1;
  }

  .nav-link[data-active='true'] {
    color: hsl(var(--p));
    transform: translateY(-2px);
  }

  .nav-link[data-active='true']::before {
    opacity: 1;
    transform: scaleX(1) scaleY(1);
    box-shadow: 0 0 0 1px rgba(255, 77, 154, 0.32), 0 12px 22px rgba(17, 23, 42, 0.16);
    animation: navActivePulse 4.2s ease-in-out infinite;
  }

  .nav-link:hover::before,
  .nav-link:focus-visible::before {
    opacity: 1;
    transform: scaleX(1) scaleY(1);
  }

  .nav-link:hover,
  .nav-link:focus-visible {
    color: hsl(var(--p));
    transform: translateY(-2px);
  }

  .nav-link__icon {
    font-size: 0.95rem;
    transform: translateY(-1px) rotate(-3deg);
    transition: transform 220ms cubic-bezier(0.19, 1, 0.22, 1);
  }

  .nav-link::after {
    content: '';
    position: absolute;
    inset-inline: 10%;
    bottom: -12px;
    height: 2px;
    border-radius: 9999px;
    background: linear-gradient(90deg, rgba(255, 77, 154, 0), rgba(255, 77, 154, 0.68), rgba(72, 242, 255, 0));
    opacity: 0;
    transition: opacity 220ms ease;
  }

  .nav-link[data-active='true']::after,
  .nav-link:hover::after {
    opacity: 1;
  }

  .nav-link[data-active='true'] .nav-link__icon,
  .nav-link:hover .nav-link__icon {
    transform: translateY(-2px) rotate(-8deg);
  }

  .nav-link__label {
    letter-spacing: 0.28em;
    transition: color 200ms ease;
  }

  .nav-link[data-active='true'] .nav-link__label,
  .nav-link:hover .nav-link__label {
    color: hsl(var(--p));
  }

  .nav-link--mobile {
    width: 100%;
    justify-content: flex-start;
    border-radius: 18px;
  }

  @keyframes navActivePulse {
    0% {
      box-shadow: 0 0 0 1px rgba(255, 77, 154, 0.32), 0 12px 22px rgba(17, 23, 42, 0.16);
    }
    50% {
      box-shadow: 0 0 0 1px rgba(72, 242, 255, 0.5), 0 16px 32px rgba(17, 23, 42, 0.2);
    }
    100% {
      box-shadow: 0 0 0 1px rgba(255, 77, 154, 0.32), 0 12px 22px rgba(17, 23, 42, 0.16);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .nav-link,
    .brand-link,
    .brand-link::after {
      transition: none;
    }

    .nav-link::before,
    .nav-link::after,
    .nav-link__icon {
      transition: none;
    }

    .nav-link[data-active='true']::before {
      animation: none;
    }
  }
</style>
