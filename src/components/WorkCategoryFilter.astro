---
export interface Props {
  /** All available categories (sorted alphabetically) */
  categories: string[];
  /** Currently active category (null for "all projects" view) */
  activeCategory?: string | null;
}

const { categories, activeCategory = null } = Astro.props;

// Helper to create URL-safe slugs from category names
function slugify(text: string): string {
  return text
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)/g, '');
}

function getCategoryUrl(cat: string): string {
  return `/work/category/${slugify(cat)}`;
}

const isAllActive = activeCategory === null;
---

<div class="relative -mx-2 sm:mx-0 group mb-8 sm:mb-12">
  <nav 
    class="flex flex-nowrap justify-start sm:justify-center gap-2 min-w-0 overflow-x-auto px-4 sm:px-0 py-2 scrollbar-hide snap-x snap-mandatory overscroll-contain" 
    transition:name="work-category-nav"
    id="work-category-nav"
  >
    <a 
      href="/work"
      class={`btn btn-sm font-semibold text-xs uppercase tracking-wider flex-shrink-0 snap-start ${isAllActive ? 'btn-accent' : 'btn-outline'}`}
      aria-current={isAllActive ? 'page' : undefined}
    >
      ALL PROJECTS
    </a>
    {categories.map((category) => (
      <a 
        href={getCategoryUrl(category)}
        class={`btn btn-sm font-semibold text-xs uppercase tracking-wider flex-shrink-0 snap-start ${category === activeCategory ? 'btn-accent' : 'btn-outline'}`}
        aria-current={category === activeCategory ? 'page' : undefined}
      >
        {category}
      </a>
    ))}
  </nav>
  
  <!-- Right edge fade (mobile only) -->
  <div class="absolute right-0 h-8 top-1/2 -translate-y-1/2 w-12 bg-gradient-to-l from-base-100 to-transparent pointer-events-none sm:hidden"></div>
</div>

<script>
  function setupHorizontalScroll() {
    const nav = document.getElementById('work-category-nav');
    if (!nav) return;

    // Scroll active category into view
    const activeLink = nav.querySelector('.btn-accent');
    if (activeLink) {
      // Use instant behavior for initial load to prevent jumpiness, or smooth if preferred
      // For layout shifts, instant is often better.
      activeLink.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }

    // Convert vertical scroll to horizontal
    nav.addEventListener('wheel', (e) => {
      if (e.deltaY !== 0) {
        // If scrolling vertically, scroll horizontally instead
        // But only if we are at a breakpoint where it scrolls (mobile)
        if (window.innerWidth < 640) {
           e.preventDefault();
           nav.scrollLeft += e.deltaY;
        }
      }
    }, { passive: false });
  }

  // Run on initial load and after swaps
  setupHorizontalScroll();
  document.addEventListener('astro:page-load', setupHorizontalScroll);
</script>
