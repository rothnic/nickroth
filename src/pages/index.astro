---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import CapabilityCard from '../components/CapabilityCard.astro';
import CapabilitiesMarquee from '../components/CapabilitiesMarquee.astro';
import WorkCard from '../components/WorkCard.astro';
import { getCollection } from 'astro:content';

const capabilities = await getCollection('capabilities');
const sortedCapabilities = capabilities
  .sort((a, b) => a.data.order - b.data.order);

const work = await getCollection('work');
const featuredWork = work
  .filter(w => w.data.featured)
  .sort((a, b) => {
    const aDate = a.data.endDate || new Date();
    const bDate = b.data.endDate || new Date();
    return bDate.getTime() - aDate.getTime();
  })
  .slice(0, 2);

const notes = await getCollection('notes');
const recentNotes = notes
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .slice(0, 3);
---

<BaseLayout>
  <Hero />
  
  <!-- Full-Stack Capabilities in Torn Gap -->
  <section id="capabilities" class="torn-gap">
    <CapabilitiesMarquee />
  </section>
  
  <!-- Capabilities Section - Rotated Card on Graph Paper -->
  <!-- <section class="rotated-section rotated-section-sm">
    <h2 class="text-4xl font-bold text-center mb-12 uppercase">Core Capabilities</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {sortedCapabilities.map((capability) => (
        <CapabilityCard
          title={capability.data.title}
          description={capability.data.description}
          icon={capability.data.icon}
        />
      ))}
    </div>
  </section> -->

  <!-- Featured Work Section - Rotated Card -->
  <section id="projects">
    <div class="section-content">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold mb-4 uppercase">Recent Work</h2>
        <p class="text-lg text-base-content/70 uppercase">Case studies showcasing the systematic approach from discovery through delivery.</p>
      </div>
      {featuredWork.length > 0 ? (
        <div class="grid grid-cols-2 gap-3 sm:gap-6 max-w-5xl mx-auto mb-12">
          {featuredWork.map((project) => (
            <WorkCard
              title={project.data.title}
              description={project.data.description}
              company={project.data.company}
              role={project.data.role}
              slug={project.slug}
              tags={project.data.tags}
              image={project.data.image}
              category={project.data.category}
              impact={project.data.impact}
              stack={project.data.stack}
              roleCategory={project.data.roleCategory}
            />
          ))}
        </div>
      ) : null}
      
      <div class="text-center">
        <a href="/work" class="btn btn-primary btn-lg">VIEW ALL WORK â†’</a>
      </div>
    </div>
  </section>

  <!-- Recent Updates Section -->
  {recentNotes.length > 0 && (
    <section id="process" class="rotated-section rotated-section-lg">
      <h2 class="text-4xl font-bold text-center mb-12 uppercase">Recent Updates</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {recentNotes.map((note) => (
          <div class="card bg-base-100 shadow-lg border-4 border-[var(--nr-border-color)]">
            <div class="card-body">
              <h3 class="card-title text-lg">{note.data.title}</h3>
              <p class="text-sm opacity-75 mb-2">
                {new Date(note.data.publishDate).toLocaleDateString()}
              </p>
              <p class="text-sm mb-3">{note.data.description}</p>
              <div class="flex flex-wrap gap-1">
                {note.data.tags.slice(0, 3).map((tag: string) => (
                  <div class="badge badge-outline badge-xs">{tag}</div>
                ))}
              </div>
            </div>
          </div>
        ))}
      </div>
    </section>
  )}

  <!-- Contact Section -->
  <section id="contact" class="py-20">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h2 class="text-4xl font-bold mb-6 uppercase">Let's Work Together</h2>
      <p class="text-xl mb-8">
        Have a project in mind? Let's discuss how I can help turn your business objectives into shippable systems.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="mailto:contact@nickroth.com" class="btn btn-primary btn-lg">
          Email Me
        </a>
        <a href="https://www.linkedin.com/in/nicholasleeroth" target="_blank" rel="noopener noreferrer" class="btn btn-secondary btn-lg">
          Connect on LinkedIn
        </a>
      </div>
    </div>
  </section>
</BaseLayout>