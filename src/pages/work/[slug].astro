---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import {} from 'astro:transitions';
import { Button } from '@/components/neobrutalism/Button';
import { Badge } from '@/components/neobrutalism/Badge';

export async function getStaticPaths() {
  const workEntries = await getCollection('work');
  return workEntries.map((entry: CollectionEntry<'work'>) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<'work'>;
};

const { entry } = Astro.props as Props;
const { Content } = await entry.render();
const PLACEHOLDER_IMAGE = 'https://placehold.co/600x400';
const coverImage = entry.data.image?.trim() ? entry.data.image : PLACEHOLDER_IMAGE;
---

<BaseLayout title={`${entry.data.title} - Nick Roth`} description={entry.data.description}>
  <main class="py-20 bg-background">
    <div class="container mx-auto px-4 max-w-6xl">
      <!-- Navigation -->
      <div class="mb-8">
        <Button variant="outline" size="sm" client:load>
          <a href="/work" class="no-underline text-inherit font-medium">← Back to Work Portfolio</a>
        </Button>
      </div>

      <!-- Hero Section Card -->
      <div class="inline-block border-2 border-black rounded shadow-md bg-card w-full mb-16">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Project Image -->
          <div class="p-6 pb-0 lg:pb-6">
            <div class="border-2 border-black rounded overflow-hidden shadow-md hover:shadow-none transition-all duration-200">
              <img 
                src={coverImage} 
                alt={entry.data.title} 
                class="w-full h-80 object-cover"
                transition:name={`work-img-${entry.slug}`}
              />
            </div>
          </div>
          
          <!-- Project Header -->
          <div class="p-6 flex flex-col justify-center">
            <h1 
              transition:name={`work-title-${entry.slug}`} 
              class="text-4xl md:text-5xl font-bold mb-4 leading-tight text-foreground"
            >
              {entry.data.title}
            </h1>
            
            <!-- Impact Statement -->
            {entry.data.impact && (
              <div class="mb-6">
                <h2 class="text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-2">Impact Statement</h2>
                <p class="text-xl font-bold text-primary uppercase leading-tight">
                  {entry.data.impact}
                </p>
              </div>
            )}
            
            <!-- Role Category -->
            {entry.data.roleCategory && (
              <div class="mb-6">
                <h2 class="text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-2">Role</h2>
                <Badge variant="primary" className="font-bold uppercase tracking-wider">
                  {entry.data.roleCategory}
                </Badge>
              </div>
            )}
            
            <!-- Project Timeline -->
            <div class="mb-6">
              <h2 class="text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-2">Timeline</h2>
              <p class="text-muted-foreground">
                {entry.data.startDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })} - 
                {entry.data.endDate ? entry.data.endDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) : 'Present'}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
        <!-- Main Content Column -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Overview Section -->
          <div class="inline-block border-2 border-black rounded shadow-md hover:shadow-none hover:translate-y-1 bg-card w-full transition-all duration-200">
            <div class="p-8">
              <h2 class="text-2xl font-bold mb-4 text-primary">CHALLENGE & OVERVIEW</h2>
              <p class="text-muted-foreground leading-relaxed">
                {entry.data.description}
              </p>
            </div>
          </div>

          <!-- Systematic Approach -->
          <div class="inline-block border-2 border-black rounded shadow-md hover:shadow-none hover:translate-y-1 bg-card w-full transition-all duration-200">
            <div class="p-8">
              <h2 class="text-2xl font-bold mb-6 text-primary">SYSTEMATIC APPROACH</h2>
              <div class="space-y-6">
                <div class="flex items-start gap-4">
                  <div class="inline-block border-2 border-black rounded-full shadow-md bg-primary text-primary-foreground w-10 h-10 flex items-center justify-center font-bold flex-shrink-0">
                    1
                  </div>
                  <div>
                    <h3 class="font-bold text-lg mb-2 text-foreground">DISCOVER</h3>
                    <p class="text-muted-foreground">Comprehensive analysis of existing systems, workflows, and performance baselines</p>
                  </div>
                </div>
                
                <div class="flex items-start gap-4">
                  <div class="inline-block border-2 border-black rounded-full shadow-md bg-primary text-primary-foreground w-10 h-10 flex items-center justify-center font-bold flex-shrink-0">
                    2
                  </div>
                  <div>
                    <h3 class="font-bold text-lg mb-2 text-foreground">MODEL</h3>
                    <p class="text-muted-foreground">Architecture design and technology selection with structured content modeling</p>
                  </div>
                </div>
                
                <div class="flex items-start gap-4">
                  <div class="inline-block border-2 border-black rounded-full shadow-md bg-primary text-primary-foreground w-10 h-10 flex items-center justify-center font-bold flex-shrink-0">
                    3
                  </div>
                  <div>
                    <h3 class="font-bold text-lg mb-2 text-foreground">SPECIFY</h3>
                    <p class="text-muted-foreground">Detailed implementation planning with migration strategy and testing framework</p>
                  </div>
                </div>
                
                <div class="flex items-start gap-4">
                  <div class="inline-block border-2 border-black rounded-full shadow-md bg-primary text-primary-foreground w-10 h-10 flex items-center justify-center font-bold flex-shrink-0">
                    4
                  </div>
                  <div>
                    <h3 class="font-bold text-lg mb-2 text-foreground">BUILD</h3>
                    <p class="text-muted-foreground">Incremental implementation with continuous validation and performance optimization</p>
                  </div>
                </div>
                
                <div class="flex items-start gap-4">
                  <div class="inline-block border-2 border-black rounded-full shadow-md bg-primary text-primary-foreground w-10 h-10 flex items-center justify-center font-bold flex-shrink-0">
                    5
                  </div>
                  <div>
                    <h3 class="font-bold text-lg mb-2 text-foreground">PROVE</h3>
                    <p class="text-muted-foreground">Impact measurement, optimization, and long-term maintenance planning</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Business Impact -->
          <div class="inline-block border-2 border-black rounded shadow-md hover:shadow-none hover:translate-y-1 bg-accent/5 border-accent/50 w-full transition-all duration-200">
            <div class="p-8">
              <h2 class="text-2xl font-bold mb-4 text-accent">BUSINESS IMPACT</h2>
              <p class="text-muted-foreground leading-relaxed">
                Successfully modernized platform serving 2M+ monthly users with significant improvements in performance, 
                authoring experience, and technical maintainability. Editorial team now focuses on content strategy 
                rather than technical workarounds, enabling higher content quality and publication velocity.
              </p>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-8">
          <!-- Technology Stack -->
          {entry.data.stack && entry.data.stack.length > 0 && (
            <div class="inline-block border-2 border-black rounded shadow-md hover:shadow-none hover:translate-y-1 bg-card w-full transition-all duration-200">
              <div class="p-6">
                <h3 class="text-lg font-bold mb-4 text-primary">TECHNOLOGY STACK</h3>
                <div class="flex flex-wrap gap-2">
                  {entry.data.stack.map((tech) => (
                    <Badge variant="info" className="font-medium">
                      {tech}
                    </Badge>
                  ))}
                </div>
              </div>
            </div>
          )}

          <!-- Project Category -->
          {entry.data.category && (
            <div class="inline-block border-2 border-black rounded shadow-md hover:shadow-none hover:translate-y-1 bg-card w-full transition-all duration-200">
              <div class="p-6">
                <h3 class="text-lg font-bold mb-4 text-primary">PROJECT CATEGORY</h3>
                <Badge variant="primary" className="font-semibold">
                  {entry.data.category}
                </Badge>
              </div>
            </div>
          )}

          <!-- Key Outcomes -->
          <div class="inline-block border-2 border-black rounded shadow-md hover:shadow-none hover:translate-y-1 bg-success/5 border-success/50 w-full transition-all duration-200">
            <div class="p-6">
              <h3 class="text-lg font-bold mb-4 text-success">KEY OUTCOMES</h3>
              <div class="space-y-3">
                <div class="flex items-center gap-3">
                  <div class="w-2 h-2 bg-success rounded-full flex-shrink-0"></div>
                  <span class="text-sm font-semibold text-foreground">40% improvement in Core Web Vitals</span>
                </div>
                <div class="flex items-center gap-3">
                  <div class="w-2 h-2 bg-success rounded-full flex-shrink-0"></div>
                  <span class="text-sm font-semibold text-foreground">60% reduction in publishing time</span>
                </div>
                <div class="flex items-center gap-3">
                  <div class="w-2 h-2 bg-success rounded-full flex-shrink-0"></div>
                  <span class="text-sm font-semibold text-foreground">25% increase in organic traffic</span>
                </div>
                <div class="flex items-center gap-3">
                  <div class="w-2 h-2 bg-success rounded-full flex-shrink-0"></div>
                  <span class="text-sm font-semibold text-foreground">90% reduction in deployment time</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Project Tags -->
          {entry.data.tags && entry.data.tags.length > 0 && (
            <div class="inline-block border-2 border-black rounded shadow-md hover:shadow-none hover:translate-y-1 bg-card w-full transition-all duration-200">
              <div class="p-6">
                <h3 class="text-lg font-bold mb-4 text-primary">PROJECT TAGS</h3>
                <div class="flex flex-wrap gap-2">
                  {entry.data.tags.slice(0, 5).map((tag) => (
                    <Badge variant="warning" className="font-medium">
                      {tag}
                    </Badge>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      </div>

      <!-- Navigation Footer -->
      <div class="mt-16 pt-8 border-t-4 border-black">
        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
          <Button variant="default" size="lg" client:load>
            <a href="/work" class="no-underline text-inherit font-medium">← View All Projects</a>
          </Button>
          <Button variant="outline" size="lg" client:load>
            <a href="/contact" class="no-underline text-inherit font-medium">Discuss Your Project →</a>
          </Button>
        </div>
      </div>
    </div>
  </main>
</BaseLayout>