---
import { getCollection } from 'astro:content';

import BaseLayout from '../../layouts/BaseLayout.astro';
import { Badge } from '../../components/ui/badge';

const { slug } = Astro.params;
const workEntries = await getCollection('work');
const entry = workEntries.find((item) => item.slug === slug);

if (!entry) {
  throw new Error(`Work entry not found for slug: ${slug}`);
}

const { Content } = await entry.render();
const { data } = entry;

export async function getStaticPaths() {
  const workEntries = await getCollection('work');
  return workEntries.map((item) => ({ params: { slug: item.slug } }));
}
---
<BaseLayout title={`${data.title} â€“ Work by Nick Roth`} description={data.description}>
  <article class="mx-auto w-full max-w-[var(--container-width)] px-5 py-20">
    <header class="mb-12 space-y-4">
      <div class="flex flex-wrap items-center gap-2">
        <Badge client:load variant="neutral" className="uppercase tracking-wide">
          {data.company}
        </Badge>
        {data.category && (
          <Badge
            client:load
            variant="default"
            className="uppercase tracking-wide"
          >
            {data.category}
          </Badge>
        )}
      </div>
      <h1 class="text-4xl font-heading sm:text-5xl">{data.title}</h1>
      <p class="max-w-3xl text-base font-base text-foreground/75">{data.description}</p>
      {data.impact && (
        <div class="rounded-base border-2 border-border bg-main p-4 text-main-foreground shadow-shadow">
          <span class="font-heading uppercase tracking-wide">Impact</span>
          <p class="mt-1 text-lg font-base">{data.impact}</p>
        </div>
      )}
    </header>
    <div class="prose prose-lg max-w-none prose-headings:font-heading prose-p:font-base prose-p:text-foreground/80">
      <Content />
    </div>
  </article>
</BaseLayout>
