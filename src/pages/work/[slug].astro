---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import {} from 'astro:transitions';

export async function getStaticPaths() {
  const workEntries = await getCollection('work');
  return workEntries.map((entry: CollectionEntry<'work'>) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<'work'>;
};

const { entry } = Astro.props as Props;
const PLACEHOLDER_IMAGE = 'https://placehold.co/600x400';
const coverImage = entry.data.image?.trim() ? entry.data.image : PLACEHOLDER_IMAGE;

const projectMeta = [entry.data.company, entry.data.role].filter(Boolean);
const timelineLabel = `${entry.data.startDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })} – ${entry.data.endDate ? entry.data.endDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : 'Present'}`;

// Get color schemes for different categories
const getCategoryColor = (cat: string | undefined) => {
  switch (cat) {
    case 'HEADLESS CMS': return 'badge-primary';
    case 'WEB PLATFORMS': return 'badge-secondary';  
    case 'MARKETING AUTOMATION': return 'badge-accent';
    case 'AUTOMATION & AI': return 'badge-warning';
    case 'CHROME EXTENSIONS': return 'badge-info';
    case 'SYSTEMS': return 'badge-success';
    default: return 'badge-outline';
  }
};

const getStackColor = (tech: string) => {
  const lowerTech = tech.toLowerCase();
  if (lowerTech.includes('astro') || lowerTech.includes('datocms')) return 'badge-primary';
  if (lowerTech.includes('n8n') || lowerTech.includes('windmill')) return 'badge-warning';
  if (lowerTech.includes('chrome') || lowerTech.includes('openai')) return 'badge-info';
  if (lowerTech.includes('langchain')) return 'badge-success';
  if (tech.includes('+')) return 'badge-success';
  return 'badge-outline';
};
---

<BaseLayout title={`${entry.data.title} - Nick Roth`} description={entry.data.description}>
  <main class="pt-12 pb-28 sm:pt-16">
    <div class="container mx-auto max-w-6xl px-4">
      <!-- Navigation -->
      <div class="mb-10 flex flex-wrap items-center justify-between gap-4 text-xs uppercase tracking-[0.32em] text-base-content/60">
        <a href="/work" class="inline-flex items-center gap-2 rounded-full border border-base-300/60 bg-base-100/80 px-4 py-2 font-semibold shadow-sm transition-colors duration-200 hover:border-primary hover:text-primary">
          ← Back to all work
        </a>
        <span class="inline-flex items-center gap-2 rounded-full border border-base-300/60 bg-base-100/70 px-4 py-2">
          {timelineLabel}
        </span>
      </div>

      <!-- Hero Section -->
      <section transition:name={`work-shell-${entry.slug}`} class="mb-16 grid grid-cols-1 items-start gap-12 lg:grid-cols-[minmax(0,1.1fr)_minmax(320px,420px)]">
        <div class="space-y-8">
          <div class="flex flex-wrap items-center gap-3 text-[0.65rem] font-semibold uppercase tracking-[0.32em] text-base-content/60">
            {entry.data.category && (
              <span class="inline-flex items-center gap-2 rounded-full border border-base-300/70 bg-base-100/80 px-3 py-1">
                {entry.data.category}
              </span>
            )}
            {entry.data.roleCategory && (
              <span class="inline-flex items-center gap-2 rounded-full border border-dashed border-base-300/70 bg-base-100/70 px-3 py-1">
                {entry.data.roleCategory}
              </span>
            )}
          </div>

          <h1 transition:name={`work-title-${entry.slug}`} class="text-4xl font-black leading-tight tracking-tight text-base-content sm:text-5xl">
            {entry.data.title}
          </h1>

          <p class="max-w-2xl text-base leading-relaxed text-base-content/75 sm:text-lg">
            {entry.data.description}
          </p>

          {entry.data.impact && (
            <p class="text-xs font-semibold uppercase tracking-[0.38em] text-primary">
              {entry.data.impact}
            </p>
          )}

          {projectMeta.length > 0 && (
            <div class="flex flex-wrap items-center gap-3 text-xs font-semibold uppercase tracking-[0.28em] text-base-content/60">
              {projectMeta.join(' • ')}
            </div>
          )}

          {entry.data.tags && entry.data.tags.length > 0 && (
            <ul class="flex flex-wrap gap-2 text-xs text-base-content/65">
              {entry.data.tags.map((tag) => (
                <li class="inline-flex items-center rounded-full border border-base-300/60 bg-base-100/80 px-3 py-1 uppercase tracking-[0.18em]">
                  {tag}
                </li>
              ))}
            </ul>
          )}
        </div>

        <figure transition:name={`work-img-${entry.slug}`} class="relative overflow-hidden rounded-[32px] border-2 border-base-300/70 bg-base-100/85 shadow-brutal">
          <img src={coverImage} alt={entry.data.title} class="h-full w-full object-cover transition-transform duration-500 ease-out hover:scale-[1.04] hover:rotate-1" />
          <div class="pointer-events-none absolute inset-0 bg-gradient-to-br from-primary/18 via-transparent to-accent/18 mix-blend-screen"></div>
          <div class="pointer-events-none absolute inset-5 rounded-[26px] border border-dashed border-base-content/10"></div>
        </figure>
      </section>

      <!-- Structured Content Sections -->
      <div class="grid grid-cols-1 gap-12 lg:grid-cols-[minmax(0,1.1fr)_minmax(300px,360px)]">
        <!-- Main Content Column -->
        <div class="space-y-10">
          <section class="rounded-[28px] border border-base-300/60 bg-base-100/85 p-8 shadow-[0_18px_36px_rgba(24,24,37,0.1)]">
            <h2 class="text-xs font-semibold uppercase tracking-[0.32em] text-base-content/60">Challenge & Overview</h2>
            <div class="prose prose-sm max-w-none text-base-content/80 sm:prose-base">
              <p>{entry.data.description}</p>
            </div>
          </section>

          <section class="rounded-[28px] border border-base-300/60 bg-base-100/85 p-8 shadow-[0_18px_36px_rgba(24,24,37,0.1)]">
            <h2 class="text-xs font-semibold uppercase tracking-[0.32em] text-base-content/60">Systematic Approach</h2>
            <ol class="mt-6 space-y-5">
              <li class="group flex items-start gap-4 rounded-2xl border border-base-300/50 bg-base-100/70 px-5 py-4">
                <span class="mt-1 inline-flex h-8 w-8 flex-none items-center justify-center rounded-full bg-primary/90 text-xs font-bold text-primary-content shadow-sm">1</span>
                <div>
                  <h3 class="text-sm font-semibold uppercase tracking-[0.28em] text-base-content/70">Discover</h3>
                  <p class="mt-2 text-sm text-base-content/75">Comprehensive analysis of existing systems, workflows, and performance baselines.</p>
                </div>
              </li>
              <li class="group flex items-start gap-4 rounded-2xl border border-base-300/50 bg-base-100/70 px-5 py-4">
                <span class="mt-1 inline-flex h-8 w-8 flex-none items-center justify-center rounded-full bg-primary/90 text-xs font-bold text-primary-content shadow-sm">2</span>
                <div>
                  <h3 class="text-sm font-semibold uppercase tracking-[0.28em] text-base-content/70">Model</h3>
                  <p class="mt-2 text-sm text-base-content/75">Architecture design and technology selection with structured content modeling.</p>
                </div>
              </li>
              <li class="group flex items-start gap-4 rounded-2xl border border-base-300/50 bg-base-100/70 px-5 py-4">
                <span class="mt-1 inline-flex h-8 w-8 flex-none items-center justify-center rounded-full bg-primary/90 text-xs font-bold text-primary-content shadow-sm">3</span>
                <div>
                  <h3 class="text-sm font-semibold uppercase tracking-[0.28em] text-base-content/70">Specify</h3>
                  <p class="mt-2 text-sm text-base-content/75">Detailed implementation planning with migration strategy and testing framework.</p>
                </div>
              </li>
              <li class="group flex items-start gap-4 rounded-2xl border border-base-300/50 bg-base-100/70 px-5 py-4">
                <span class="mt-1 inline-flex h-8 w-8 flex-none items-center justify-center rounded-full bg-primary/90 text-xs font-bold text-primary-content shadow-sm">4</span>
                <div>
                  <h3 class="text-sm font-semibold uppercase tracking-[0.28em] text-base-content/70">Build</h3>
                  <p class="mt-2 text-sm text-base-content/75">Incremental implementation with continuous validation and performance optimization.</p>
                </div>
              </li>
              <li class="group flex items-start gap-4 rounded-2xl border border-base-300/50 bg-base-100/70 px-5 py-4">
                <span class="mt-1 inline-flex h-8 w-8 flex-none items-center justify-center rounded-full bg-primary/90 text-xs font-bold text-primary-content shadow-sm">5</span>
                <div>
                  <h3 class="text-sm font-semibold uppercase tracking-[0.28em] text-base-content/70">Prove</h3>
                  <p class="mt-2 text-sm text-base-content/75">Impact measurement, optimization, and long-term maintenance planning.</p>
                </div>
              </li>
            </ol>
          </section>

          <section class="rounded-[28px] border border-accent/25 bg-accent/10 p-8 shadow-[0_18px_36px_rgba(24,24,37,0.1)]">
            <h2 class="text-xs font-semibold uppercase tracking-[0.32em] text-accent-content/80">Business Impact</h2>
            <p class="mt-4 text-base leading-relaxed text-base-content/80">
              Successfully modernized a platform serving 2M+ monthly users with significant improvements in performance,
              authoring experience, and technical maintainability. Editorial teams now focus on content strategy
              rather than technical workarounds, enabling higher quality and faster publication velocity.
            </p>
          </section>
        </div>

        <!-- Sidebar -->
        <aside class="space-y-6">
          <section class="rounded-[24px] border border-base-300/60 bg-base-100/85 p-6 shadow-sm">
            <h3 class="text-xs font-semibold uppercase tracking-[0.32em] text-base-content/60">Timeline</h3>
            <p class="mt-3 text-sm text-base-content/75">{timelineLabel}</p>
          </section>

          {entry.data.stack && entry.data.stack.length > 0 && (
            <section class="rounded-[24px] border border-base-300/60 bg-base-100/85 p-6 shadow-sm">
              <h3 class="text-xs font-semibold uppercase tracking-[0.32em] text-base-content/60">Technology Stack</h3>
              <div class="mt-3 flex flex-wrap gap-2">
                {entry.data.stack.map((tech) => (
                  <span class={`badge ${getStackColor(tech)} badge-sm font-medium text-xs`}>{tech}</span>
                ))}
              </div>
            </section>
          )}

          {entry.data.category && (
            <section class="rounded-[24px] border border-base-300/60 bg-base-100/85 p-6 shadow-sm">
              <h3 class="text-xs font-semibold uppercase tracking-[0.32em] text-base-content/60">Project Category</h3>
              <span class={`badge mt-3 inline-flex items-center gap-2 border-base-300/60 bg-base-100 px-4 py-2 text-xs font-semibold uppercase tracking-[0.28em] ${getCategoryColor(entry.data.category)}`}>
                {entry.data.category}
              </span>
            </section>
          )}

          <section class="rounded-[24px] border border-success/25 bg-success/10 p-6 shadow-sm">
            <h3 class="text-xs font-semibold uppercase tracking-[0.32em] text-success/80">Key Outcomes</h3>
            <ul class="mt-4 space-y-3 text-sm text-base-content/80">
              <li class="flex items-center gap-2"><span class="inline-flex h-2 w-2 rounded-full bg-success"></span>40% improvement in Core Web Vitals</li>
              <li class="flex items-center gap-2"><span class="inline-flex h-2 w-2 rounded-full bg-success"></span>60% reduction in publishing time</li>
              <li class="flex items-center gap-2"><span class="inline-flex h-2 w-2 rounded-full bg-success"></span>25% increase in organic traffic</li>
              <li class="flex items-center gap-2"><span class="inline-flex h-2 w-2 rounded-full bg-success"></span>90% reduction in deployment time</li>
            </ul>
          </section>
        </aside>
      </div>

      <!-- Navigation Footer -->
      <div class="mt-16 pt-8 border-t border-base-300">
        <div class="flex justify-between items-center">
          <a href="/work" class="btn btn-primary">
            ← View All Projects
          </a>
          <a href="/contact" class="btn btn-outline">
            Discuss Your Project →
          </a>
        </div>
      </div>
    </div>
  </main>
</BaseLayout>