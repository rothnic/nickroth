---
import { getCollection } from "astro:content";
import WorkCard from "../../components/WorkCard.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import ContentLayout from "../../components/ContentLayout.astro";
import PageHeader from "../../components/PageHeader.astro";
import WorkCategoryFilter from "../../components/WorkCategoryFilter.astro";

const workEntries = await getCollection("work");
const sortedWork = workEntries.sort((a, b) => {
	const aDate = a.data.endDate || new Date();
	const bDate = b.data.endDate || new Date();
	return bDate.getTime() - aDate.getTime();
});

// Get unique categories for filtering - SORTED ALPHABETICALLY for consistency
const categories = [...new Set(workEntries.map((work) => work.data.category).filter(Boolean))].sort() as string[];
---

<BaseLayout title="Work - NR" description="Case studies demonstrating systematic approach to product development from discovery through delivery">
  <ContentLayout>
    <PageHeader
      title="Projects"
      subtitle="Portfolio"
      description="Case studies demonstrating systematic approach to product development, from discovery through delivery with measurable outcomes."
    />

    <WorkCategoryFilter categories={categories} />

    <!-- Projects Grid -->
    <div class="grid grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-6 max-w-5xl mx-auto">
      {sortedWork.map((work) => (
        <WorkCard entry={work} mode="card" />
      ))}
    </div>
    
    {sortedWork.length === 0 && (
      <div class="text-center">
        <p class="text-lg opacity-75">No projects yet. Check back soon!</p>
      </div>
    )}
  </ContentLayout>
</BaseLayout>