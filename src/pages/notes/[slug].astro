---
import { getCollection } from 'astro:content';

import BaseLayout from '../../layouts/BaseLayout.astro';
import { Badge } from '../../components/ui/badge';

const { slug } = Astro.params;
const notes = await getCollection('notes');
const entry = notes.find((item) => item.slug === slug && !item.data.draft);

if (!entry) {
  throw new Error(`Note not found for slug: ${slug}`);
}

const { Content } = await entry.render();
const { data } = entry;

export async function getStaticPaths() {
  const notes = await getCollection('notes');
  return notes
    .filter((item) => !item.data.draft)
    .map((item) => ({ params: { slug: item.slug } }));
}
---
<BaseLayout title={`${data.title} â€“ Notes by Nick Roth`} description={data.description}>
  <article class="mx-auto w-full max-w-[var(--container-width)] px-5 py-20">
    <header class="mb-12 space-y-4 text-center">
      <Badge client:load variant="neutral" className="mx-auto text-xs uppercase tracking-wide">
        {new Date(data.publishDate).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })}
      </Badge>
      <h1 class="text-4xl font-heading sm:text-5xl">{data.title}</h1>
      <p class="mx-auto max-w-3xl text-base font-base text-foreground/75">{data.description}</p>
    </header>
    <div class="prose prose-lg mx-auto max-w-3xl prose-headings:font-heading prose-p:font-base prose-p:text-foreground/80">
      <Content />
    </div>
  </article>
</BaseLayout>
